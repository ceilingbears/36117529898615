<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>spelling bee</title>
    <link rel="icon" href="favicon.ico" sizes="32x32">
    <link rel="icon" href="icon_192.png" type="image/png">
	<link rel="apple-touch-icon" href="icon_180.png">
    <link rel="manifest" href="manifest.json">
    <style>
    	:root {
		  --color-1: #262200;
		  --color-1m: #3A3400;
		  --color-5: #4C4500;
		  --color-5m: #665C00;
		  --color-6: #807300;
		  --color-6m: #AB9A00;
		  --color-7: #D9C300;
		  --color-7m: #EBD300;
		  --color-s: #FFE600;
		  --light: #F9F8F6;
		  --dark: #111000;
		  --light-gray: #4C4C4C;
		}
        body {
        	background-color: var(--color-1);
        	padding: 0;
        	margin: 0 8px;
        	touch-action: manipulation;
        }
        #game-area {
        	max-width: 500px;
        	position: relative;
        	display: flex;
		    flex-direction: column;
		    min-height: 100vh;
		    margin: auto;
        }
        #buffer-area {
        	flex: 1;
        }
        #main-area {
        	width: 100%;
        }
        button {
        	font-size: 0.9rem;
        	padding: 8px 5px;
        }
        .play-button {
        	background-color: var(--color-1);
        	border: 1px solid var(--light);
        	border-radius: 20px;
        	color: var(--light);
        	margin: auto;
        }
        .play-button:active {
        	background-color: var(--light-gray);
        }
        .submit-button {
        	min-width: 40%;
        }
        .shuffle-button {
        	background-color: transparent;
        	border: none;
        	color: var(--light);
        	border-radius: 50%;
        	padding: 0;
        	height: 60px;
        	width: 60px;
        }
        button, .text {
        	font-family: "Gill Sans", sans-serif;
        	font-weight: lighter;
        }
        .letters {
        	text-transform: uppercase;
        }
        .hex-container {
        	height: 200px;
        	margin-bottom: 20px;
        	position: relative;
        }
		.hex-cell {
			background-color: var(--color-5);
			border: 0;
			clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
			color: var(--light);
			cursor: pointer;
			font-size: 20px;
			font-weight: normal;
			margin: 0;
			padding: 0;
			position: absolute;
			height: 60px;
			width: 69px;
			-webkit-tap-highlight-color: transparent;
		}
		.hex-cell-active {
			background-color: var(--light) !important;
			color: var(--dark) !important;
		}
		.hex-letter {
			animation-duration: 0.5s;
			animation-name: fade-in;
			user-select: none;
			-webkit-user-select: none;
		}
		.cell-0 .hex-letter {
			animation-name: none;
		}
		.cell-0 {
			background-color: var(--color-s);
			color: var(--color-1);
			left: calc(50% - 35px);
			top: 65px;
		}
		.cell-1 {
			left: calc(50% - 35px);
			top: 0;
		}
		.cell-2 {
			left: calc(50% + 21px);
			top: 32px;
		}
		.cell-3 {
			left: calc(50% + 21px);
			top: 97px;
		}
		.cell-4 {
			left: calc(50% - 35px);
			top: 129px;
		}
		.cell-5 {
			left: calc(50% - 91px);
			top: 97px;
		}
		.cell-6 {
			left: calc(50% - 91px);
			top: 32px;
		}
		.control-group {
			max-width: 301px;
			margin: auto;
		}
		.controls {
			display: flex;
			align-items: center;
			margin: auto;
			margin-bottom: 5px;
		}
		.row-controls {
  			justify-content: center;
  			gap: 10px;
		}
		.row-controls button {
			flex: 1 1 0px;
		}
		.edit-controls {
			margin-bottom: 0;
		}
        .edit-area {
        	display: none;
			border: none;
			height: 150px;
		}
		.control-section {
			height: 150px;
			margin-bottom: 50px;
		}
		.edit-button {
			background-color: transparent;
			border: 1px solid var(--color-6);
			border-radius: 20px;
			color: var(--color-6);
			font-size: 1rem;
			margin: auto;
		}
		.edit-button:active {
			background-color: var(--light-gray);
		}
		.edit-controls .edit-button {
			min-width: 40%;
		}
		.row-controls .edit-button {
			margin-top: 10px;
			max-width: 30%;
		}
		.edit-input {
			background-color: var(--color-1m);
			border: 0;
			box-sizing: border-box;
			color: var(--light);
			font-size: 16px;
			height: 25px;
			width: 80%;
			margin: 3px 10%;
		}
		.edit-input::placeholder {
			color: var(--color-6m);
		}
        #current-word {
        	font-size: 2rem;
			color: var(--light);
			height: 1.6rem;
			margin-bottom: 20px;
			text-align: center;
		}
		.letter {
			color: var(--light);
			padding: 0;
			margin: 0;
		}
		.gold-letter {
			color: var(--color-s);
			padding: 0;
			margin: 0;
		}
		#score-bar {
			color: var(--color-6);
			display: flex;
			align-items: center;
			justify-content: center;
			margin-top: 5px;
			height: 18px;
		}
		#score-bar div {
			flex: 1 1 0px;
			font-size: 1rem;
		}
		#score-next {
			text-align: right;
		}
		#score-rank {
			text-align: center;
		}
		#score-num {
			text-align: left;
		}
		#error-bar{
			height: 15px;
			text-align: center;
			text-transform: lowercase;
			margin: 15px auto;
		}
		.error-text {
			animation-duration: 0.2s;
			animation-name: fade-in;
			color: var(--color-7);
			font-size: 1rem;
		}
		#rank-bar {
			border: 1px solid var(--light);
			border-radius: 10px;
			margin-top: 2px;
			height: 15px;
			overflow: hidden;
		}
		#word-list {
			height: 35px;
		}
		#word-list-dropdown {
			position: absolute;
			top: 45px;
			left: 0;
			height: 30px;
			width: 100%;
			z-index: 11;
		}
		.word-container {
			background-color: var(--color-1);
			border: 1px solid var(--light);
			border-radius: 20px;
			color: var(--light);
			text-align: center;
			overflow: hidden;
			padding-top: 2px;
			position: absolute;
			top: 50px;
			left: 0;
			height: 23px;
			width: 100%;
			z-index: 10;
		}
		#word-list-dropdown-arrow {
			color: var(--light);
			position: absolute;
			top: 60px;
			right: 10px;
			z-index: 12;
		}
		#word-list-dropdown-arrow svg {
			width: 15px;
			height: 7px;
			display: block;
		}
		.arrow-open svg {
			animation: open-word-arrow 0.2s linear normal;
			transform: rotate(0.5turn);
		}
		.arrow-close svg {
			animation: close-word-arrow 0.2s linear normal;
			transform: rotate(0turn);
		}
		#words-container {
			display: none;
			flex-flow: column wrap;
			height: 100%;
		}
		#last-word {
			padding-top: 2px;
		}
		.words-appear {
			animation: fade-in 0.1s ease-in normal;
			opacity: 100%;
		}
		.words-disappear {
			animation: fade-out 0.1s ease-in normal;
			opacity: 0%;
		}
		.uncollapse {
			animation: open-word-list 0.2s ease-in normal;
			border-radius: 0;
			height: 91%;
		}
		.collapse {
			animation: close-word-list 0.2s ease-in normal;
			border-radius: 20px;
			height: 23px;
		}
		.word-element {
			margin-bottom: -1px;
			padding-bottom: 1px;
		}
		.word-list-1 {
			background-color: var(--color-1);
		}
		.word-list-5 {
			background-color: var(--color-5);
		}
		.word-list-6 {
			background-color: var(--color-6);
		}
		.word-list-7 {
			background-color: var(--color-7);
		}
		.word-list-s {
			background-color: var(--color-s);
			color: var(--dark);
		}
		#rank-bar {
			overflow: hidden;
			position: relative;
		}
		.rank {
			position: absolute;
			top: 0;
			width: 12.6%;
			height: 100%;
		}
		.show-rank {
			animation: add-rank 0.4s ease-in normal;
		}
		.rank-1 {
			background-color: var(--color-1m);
		}
		.rank-2 {
			background-color: var(--color-5);
		}
		.rank-3 {
			background-color: var(--color-5m);
		}
		.rank-4 {
			background-color: var(--color-6);
		}
		.rank-5 {
			background-color: var(--color-6m);
		}
		.rank-6 {
			background-color: var(--color-7);
		}
		.rank-7 {
			background-color: var(--color-7m);
		}
		.rank-8 {
			background-color: var(--color-s);
		}
		#new-score {
			position: relative;
			height: 45px;
		}
		.new-score {
			animation: new-score-popup 0.8s linear normal;
			text-align: center;
			font-size: 1.7rem;
			position: absolute;
			width: 100%;
			opacity: 0%;
			z-index: -1;
		}
		.score-1 {
			color: var(--color-5);
		}
		.score-5 {
			color: var(--color-5m);
		}
		.score-6 {
			color: var(--color-6);
		}
		.score-7 {
			color: var(--color-7);
		}
		.score-s {
			color: var(--color-s);
		}
		@keyframes fade-in {
		  0% {
		    opacity: 0%;
		  }
		  100% {
		    opacity: 100%;
		  }
		}
		@keyframes fade-out {
		  0% {
		    opacity: 100%;
		  }
		  100% {
		    opacity: 0%;
		  }
		}
		@keyframes open-word-list {
			0% {
				border-radius: 20px;
				height: 23px;
			}
			100% {
				border-radius: 0;
				height: 85%;
			}
		}
		@keyframes close-word-list {
			0% {
				border-radius: 0;
				height: 85%;
			}
			100% {
				border-radius: 20px;
				height: 23px;
			}
		}
		@keyframes open-word-arrow {
			0% {
				transform: rotate(0turn);
			}
			100% {
				transform: rotate(0.5turn);
			}
		}
		@keyframes close-word-arrow {
			0% {
				transform: rotate(0.5turn);
			}
			100% {
				transform: rotate(0turn);
			}
		}
		@keyframes add-rank {
			0% {
				width: 0%;
			}
			100% {
				width: 12.6%;
			}
		}
		@keyframes new-score-popup-1 {
			0% {
				opacity: 0;
				top: 20px;
			}
			20% {
				opacity: 100%;
				top: 0px;
			}
			80% {
				opacity: 100%;
				top: 0px;
			}
			100% {
				opacity: 0;
				top: 0px;
			}
		}
		@keyframes new-score-popup {
			0% {
				opacity: 0;
				top: 30px;
			}
			25% {
				opacity: 100%;
				top: -15px;
			}
			35% {
				opacity: 100%;
				top: -10px;
			}
			100% {
				opacity: 0;
				top: -10px;
			}
		}
    </style>
</head>
<body>
	<div id="game-area">
	<div id="top-area">
		<div id="score-bar" class="text">
			<div id="score-num">0</div>
			<div id="score-rank">rank</div>
			<div id="score-next">next | 0</div>
		</div>

		<div id="rank-bar">
		</div>

		<div id="word-list">
			<div id="word-list-dropdown" onclick="dropDownWordList()"></div>
			<div id="word-list-dropdown-arrow" onclick="dropDownWordList()">
				<svg viewBox="0 0 100 50" preserveAspectRatio="none" xmlns="http://www.w3.org">
				  <polygon points="0,0 100,0 50,50" fill="currentColor" />
				</svg>
			</div>
			<div id="word-container" class="word-container">
				<div id="last-word" class="text"></div>
				<div id="words-container"></div>
			</div>
		</div>
	</div>
	<div id="buffer-area"></div>
	<div id="main-area">

		<div id="new-score"></div>

		<div id="error-bar" class="letters text">
			<div class="error-text"></div>
		</div>

	    <div id="current-word" class="letters text"></div>

	    <div class="hex-container" id="letter-buttons">
	    </div>

	    <div id="control-area" class="control-group control-section">
	    	<div class="controls">
		        <button class="play-button submit-button" onclick="submitWord()">Submit</button>
		    </div>
	        <div class="controls row-controls">
	        	<button class="play-button" onclick="clearWord()">Clear</button>
	        	<div class="shuffle-container">
		        	<button class="play-button shuffle-button" onclick="shuffleButtons()">
						<svg width="60" height="60" fill="currentColor" stroke="currentColor" version="1.1" viewBox="0 0 132.29 132.29" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"><g transform="rotate(-90 66.351 66.46)"><path d="m17.842 66.46c0-26.795 21.718-48.517 48.509-48.517 15.399-1e-6 29.122 7.1763 38.008 18.368" fill="none" stroke-width="3.175"/><path d="m114.86 66.46c0 26.795-21.718 48.517-48.509 48.517-15.399 0-29.122-7.1763-38.008-18.368" fill="none" stroke-width="3.175"/><path d="m120.2 66.46h-10.685l5.3427-8.5553z" stroke-width="2.3468"/><path d="m12.499 66.46h10.685l-5.3427 8.5553z" stroke-width="2.3468"/></g><g transform="matrix(.49436 0 0 .49436 32.935 32.741)"><path transform="matrix(.29396 .078703 -.078767 .29372 67.733 88.928)" d="m67.733 67.733-92.525 24.792-67.733-67.733 24.792-92.525 92.525-24.792 67.733 67.733z" fill="none"  stroke-width="21.112"/><path transform="matrix(.14621 .039145 -.039177 .14609 67.733 51.156)" d="m67.733 67.733-92.525 24.792-67.733-67.733 24.792-92.525 92.525-24.792 67.733 67.733z" fill="none"  stroke-width="42.446"/><g  stroke="none"><path d="m96.885 88.928h-58.304l7.288-12.613h43.728z"/><path d="m45.869 101.54h43.728"/><path d="m45.869 101.54h43.728l-7.288 12.613h-29.152z"/></g><g fill="none"  stroke-width="6.4224"><path d="m75.021 115.57-7.288 12.613-7.288-12.613"/><path d="m126.55 63.703h-44.243l22.121 21.928z"/><path d="m53.157 63.703h-44.243l22.121 21.928z"/><path d="m75.253 38.792 12.672-22.028"/></g><path d="m83.998 23.591v-23.591l23.591 23.591z"  stroke="none"/><path d="m60.484 38.609-12.672-22.028" fill="none"  stroke-width="6.4224"/><path d="m51.739 23.408v-23.591l-23.591 23.591z"  stroke="none"/></g></svg>
		        	</button>
	        	</div>
		        <button class="play-button" onclick="deleteWord()">Delete</button>
		    </div>
		    <div class="controls edit-controls">
		        <button class="edit-button" onclick="toggleEdit(true)">Edit</button>
		    </div>
	    </div>

	    <div id="edit-area" class="edit-area control-section">
	        <input type="text" id="edit-input" class="text edit-input" maxlength="7" placeholder="enter 7 letters">
	        <input type="number" id="score-input" class="text edit-input" placeholder="enter max score (default 200)">
	        <div class="controls row-controls">
		        <button class="edit-button" onclick="finishEdit()">Finish Edit</button>
		        <button class="edit-button" onclick="toggleEdit(false)">Cancel Edit</button>
		    </div>
	    </div>
	</div>
	</div>

    <script>
		if ('serviceWorker' in navigator) {
		  window.addEventListener('load', () => {
		    navigator.serviceWorker.register('./sw.js')
		      .then(reg => console.log('Service worker registered successfully', reg))
		      .catch(err => console.log('Service worker registration failed:', err));
		  });
		}

    	let goldLetter = 'a';
        let letters = ['b', 'c', 'd', 'e', 'f', 'g'];
        let currentWordArray = [];
        let dictionary = new Set();
        let maxScore = 200;
        const rankPercents = [0, 0.025, 0.07, 0.12, 0.21, 0.35, 0.56, 0.71, 1];
        let rank = 0;

        function replaceChildren(parentEl, ...childEls) {
			if (!parentEl) return;
			while (parentEl.firstChild) {
			    parentEl.removeChild(parentEl.firstChild);
			}
			if (!childEls) return;
			childEls.forEach(el => parentEl.appendChild(el));
        }

        function renderLetters(input) {
        	let localLetters;
        	if (input) {
        		input = input.toLowerCase();
        		localLetters = input;
        	}
        	else {
        		localLetters = localStorage.getItem('letters') || '';
        	}
        	if (localLetters.length === 7) {
        		if (input) {
        			localStorage.setItem('letters', input);
        		}
            	goldLetter = localLetters[0];
                letters = localLetters.substring(1).split('');
                renderButtons();
                return true;
            }
            return false;
        }

        function initializeLetters() {
        	if (!renderLetters()) {
        		localStorage.setItem('letters', 'abcdefg');
        		renderLetters();
        	}
        }

        function renderButtons() {
            const container = document.getElementById('letter-buttons');
            container.innerHTML = '';
            const makeButton = (letter, index) => {
            	const btn = document.createElement('button');
                btn.className = 'hex-cell letters text cell-' + index;
                btn.onpointerdown = () => {
                    currentWordArray.push(letter);
                    updateDisplay();
                    btn.classList.add('hex-cell-active');
                };
                btn.onpointerup = () => {
                	btn.classList.remove('hex-cell-active');
                }
                btn.onpointerout = () => {
                	btn.classList.remove('hex-cell-active');
                }
                const btnltr = document.createElement('span');
                btnltr.className = 'hex-letter';
                btnltr.textContent = letter;
                btn.appendChild(btnltr);
                container.appendChild(btn);
            }
            makeButton(goldLetter, 0);
            let i = 1;
            letters.forEach(letter => {
                makeButton(letter, i);
                i++;
            });
        }

        function scoreWord(word) {
        	if (!word || word.length < 4 || word.indexOf(goldLetter) < 0) return 0;
        	if (word.length == 4) return 1;
        	if (isPangram(word)) return word.length + 7;
        	else return word.length;
        }

        function isPangram(word) {
        	return letters.filter(l => word.indexOf(l) < 0).length == 0;
        }

        function renderScore(savedWords) {
        	let score = 0;
        	savedWords.forEach(word => {
        		// console.log(word + ' is ' + scoreWord(word) + ' points');
        		score += scoreWord(word);
        	});
        	document.getElementById('score-num').textContent = score;

        	updateWordList(savedWords);
        	renderRank(score);
        }

        function popUpScore(word) {
        	const score = scoreWord(word);
        	const scoreEl = document.createElement('div');
        	scoreEl.className = 'text new-score';
        	if (isPangram(word)) {
        		scoreEl.classList.add('score-s');
        		scoreEl.textContent = '+pangram';
        	}
        	else if (score >= 7) {
        		scoreEl.classList.add('score-7');
        		scoreEl.textContent = '+' + score;
        	}
        	else {
        		scoreEl.classList.add('score-'+score);
        		scoreEl.textContent = '+' + score;
        	}
        	const scoreBarEl = document.getElementById('new-score');
        	replaceChildren(scoreBarEl, scoreEl);
        }

        let currentRank = 0;

        function renderRank(score) {
        	// console.log(rankPercents.map(r => maxScore * r));
        	const rankInd = rankPercents.findLastIndex(r => {
	        	return (r * maxScore) <= score;
	        });
        	// console.log('rendering rank ' + rankInd + ' for score ' + score);
        	document.getElementById('score-rank').textContent = 'rank ' + rankInd;
        	const nextScore = rankInd == rankPercents.length-1 ?
        		0 : Math.ceil(rankPercents[rankInd + 1] * maxScore - score);
        	document.getElementById('score-next').textContent = 'next | ' + nextScore;
        	const rankChilds = [];
        	for (let i = 1; i <= rankInd; i++) {
        		const rankEl = document.createElement('div');
	        	rankEl.className = 'rank rank-' + i;
	        	if (i == rankInd && currentRank < rankInd) {
	        		rankEl.classList.add('show-rank');
	        		currentRank = rankInd;
	        	}
	        	rankEl.style.left = ((i-1)/(rankPercents.length-1)*100) + '%';
	        	rankChilds.push(rankEl);
			}
			replaceChildren(document.getElementById('rank-bar'), ...rankChilds);
        }

        function updateWordList(savedWords) {
        	const wordsContainer = document.getElementById('words-container');
        	replaceChildren(wordsContainer);
        	const sortedWords = savedWords.toSorted((w1, w2) => {
        		if (w1.length == w2.length) {
        			return w1.localeCompare(w2);
        		}
        		else if (w1.length < w2.length) {
        			return -1;
        		}
        		else return 1;
        	});
        	sortedWords.forEach(w => {
        		const wordEl = document.createElement('div');
        		wordEl.className = 'text word-element';
        		if (w.length < 5) {
        			wordEl.classList.add('word-list-1');
        		}
        		else if (isPangram(w)) {
        			wordEl.classList.add('word-list-s');
        		}
        		else if (w.length >= 7) {
        			wordEl.classList.add('word-list-7');
        		}
        		else {
        			wordEl.classList.add('word-list-' + w.length);
        		}
        		wordEl.textContent = w;
        		wordsContainer.appendChild(wordEl);
        	})
        }

        function renderError(errorText) {
        	const error = document.createElement('div');
        	error.className = 'error-text';
        	error.textContent = errorText;
        	replaceChildren(document.getElementById('error-bar'), error);
        }

        function updateDisplay() {
        	renderError('');
            const letterEls = [];
            currentWordArray.forEach(letter => {
            	const l = document.createElement('span');
            	l.textContent = letter;
            	l.className = letter === goldLetter ? 'letter gold-letter' : 'letter';
            	letterEls.push(l);
            });
            if (letterEls.length == 0) {
            	letterEls.push(document.createElement('span'));
            }
            replaceChildren(document.getElementById('current-word'), ...letterEls);
        }

        function clearWord() {
        	currentWordArray = [];
        	updateDisplay();
        }

        function deleteWord() {
        	if (currentWordArray.length > 0) {
        		currentWordArray.pop();
        		updateDisplay();
        	}
        }

        function submitWord() {
            if (currentWordArray.length === 0) return;
            if (currentWordArray.length < 4) return renderError('must be 4 letters');
            
            const word = currentWordArray.join('').toLowerCase();
            if (word.indexOf(goldLetter) < 0) return renderError('missing center letter');
            if (!dictionary.has(word)) return renderError('not in dictionary');

            const savedWords = getSavedWords();
            if (savedWords.indexOf(word) >= 0) return renderError('already found');

            savedWords.push(word);
            localStorage.setItem('savedWords', JSON.stringify(savedWords));
            renderScore(savedWords);
            document.getElementById('last-word').textContent = word;
            popUpScore(word);
            
            currentWordArray = [];
            updateDisplay();
        }

        function shuffleButtons() {
            renderLetters(goldLetter + derange(letters).join(''));
        }

        function derange(array) {
		  const result = [...array];
		  const n = result.length;

		  if (n <= 1) return n === 0 ? [] : null; // No derangement possible for size 1

		  // First, do a standard Fisher-Yates shuffle
		  for (let i = n - 1; i > 0; i--) {
		    const j = Math.floor(Math.random() * (i + 1));
		    [result[i], result[j]] = [result[j], result[i]];
		  }

		  // Second pass: Fix any "fixed points" (items in original spots)
		  for (let i = 0; i < n - 1; i++) {
		    if (result[i] === array[i]) {
		      // Swap with the next element
		      [result[i], result[i + 1]] = [result[i + 1], result[i]];
		    }
		  }

		  // Final check: If the last element is a fixed point, swap with the previous
		  if (result[n - 1] === array[n - 1]) {
		    [result[n - 1], result[n - 2]] = [result[n - 2], result[n - 1]];
		  }

		  return result;
		}

		let animationTimer = 0;
		function dropDownWordList() {
			const wordContainer = document.getElementById('word-container');
			const toggleWords = (wordsEl, isShow) => {
				if (isShow) {
					wordsEl.classList.add('words-appear');
					wordsEl.classList.remove('words-disappear');
				} else {
					wordsEl.classList.add('words-disappear');
					wordsEl.classList.remove('words-appear');
				}
			}
			const toggleArrow = (arrowEl, isShow) => {
				if (isShow) {
					arrowEl.classList.add('arrow-open');
					arrowEl.classList.remove('arrow-close');
				} else {
					arrowEl.classList.add('arrow-close');
					arrowEl.classList.remove('arrow-open');
				}
			}
			if (wordContainer.classList.contains('uncollapse')) {
				// make it collapse
				toggleArrow(document.getElementById('word-list-dropdown-arrow'), false);
				const words = document.getElementById('words-container');
				toggleWords(words, false);
				clearTimeout(animationTimer);
				animationTimer = setTimeout(() => {
					wordContainer.classList.remove('uncollapse');
					wordContainer.classList.add('collapse');
					words.style.display = 'none';
					const lastWord = document.getElementById('last-word');
					lastWord.style.display = 'block';
					toggleWords(lastWord, true);
				}, 100);
			} else {
				// make it grow
				toggleArrow(document.getElementById('word-list-dropdown-arrow'), true);
				wordContainer.classList.add('uncollapse');
				wordContainer.classList.remove('collapse');
				const lastWord = document.getElementById('last-word');
				toggleWords(lastWord, false);
				clearTimeout(animationTimer);
				animationTimer = setTimeout(() => {
					const words = document.getElementById('words-container');
					words.style.display = 'flex';
					toggleWords(words, true);
					lastWord.style.display = 'none';
				}, 210);
			}
		}

        function toggleEdit(show) {
            document.getElementById('edit-area').style.display = show ? 'block' : 'none';
            document.getElementById('control-area').style.display = show ? 'none' : 'block';
            if (!show) document.getElementById('edit-input').value = '';
        }

        function finishEdit() {
            const input = document.getElementById('edit-input').value;
            const score = document.getElementById('score-input').value;
            if (score) {
            	toggleEdit(false);
            	maxScore = score;
            	localStorage.setItem('maxScore', score);
                renderScore(getSavedWords());
            }
            if (input && renderLetters(input)) {
                toggleEdit(false);
                localStorage.removeItem('savedWords');
                clearWord();
                document.getElementById('last-word').textContent = '';
                renderScore([]);
            }
        }

        async function loadWords() {
		  try {
		  	// sourced from https://github.com/meetDeveloper/freeDictionaryAPI
		    const response = await fetch('lib/english-final.txt');
		    if (!response.ok) {
		      throw new Error(`HTTP error! status: ${response.status}`);
		    }
		    const text = await response.text();
		    const wordsArray = text.split('\n');
		    dictionary = new Set(wordsArray);
		    console.log('Loaded ' + wordsArray.length + ' words');
		  } catch (error) {
		    console.error("Could not load words:", error);
		  }
		}

		function getSavedWords() {
			return JSON.parse(localStorage.getItem('savedWords') || '[]');
		}

		function getSavedMaxScore() {
			return (localStorage.getItem('maxScore') || 200);
		}

		function startUp() {
			loadWords();
	        initializeLetters();
	        maxScore = getSavedMaxScore();
	        const savedWords = getSavedWords();
	        renderScore(savedWords);
	        if (savedWords.length > 0) {
	        	document.getElementById('last-word').textContent = savedWords[savedWords.length - 1];
	        }
		}

		startUp();

		window.addEventListener('keydown', (event) => {
        	if ((document.activeElement !== document.getElementById('edit-input')) &&
        		(goldLetter === event.key || letters.indexOf(event.key) >= 0)) {
        		currentWordArray.push(event.key);
        		updateDisplay();
        	}
        	if (event.key === 'Enter') {
        		submitWord();
        	} 
        	else if (event.key === 'Delete' || event.key === 'Backspace') {
        		deleteWord();
        	}
		});
    </script>
</body>
</html>
